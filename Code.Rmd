---
title: "Effects of technology-assisted instruction with teacher prompts on fraction multiplication word problems for students with learning disabilities"
date: "`r Sys.Date()`"
output:
  html_document:
     toc: true
     toc_float: true
     code_folding: hide
     self_contained: false
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  cache = TRUE,
  message = FALSE, 
  warning = FALSE)
```

This website contains data and R code used for the data processing and analysis in Authors (2024). The scripts have been posted on an online data repository, accessible at the [Center for Open Science](https://osf.io/f9832/?view_only=dca7a2ba18ee48f7834af2539c982d20).


# Dataset {.tabset}

```{r}
suppressPackageStartupMessages({
  library(knitr)
  library(kableExtra)
  library(readxl)
  library(DT)
  library(tidyr)
  library(dplyr)
  library(downloadthis)
  library(ggh4x)
  library(broom)
  library(gridExtra)
  library(SingleCaseES)
  library(nlme)
  library(clubSandwich)
  library(lmeInfo)
  library(msm)
  library(ggplot2)
})

web_based_data <- read.csv("data/web_based_data.csv")

web_based_data_kb <- web_based_data %>%
  kbl(align = "c") %>%
  kable_styling(
    bootstrap_options = c("striped","hover","condensed"),
    full_width = T,
    font_size = 12,
    fixed_thead = T) %>%
  scroll_box(height = "400px")

web_based_data %>%
  download_this(
    output_name = "Authors (2023) Dataset, Outcomes by Question Types",
    output_extension = ".xlsx",
    button_label = "Download",
    button_type = "default",
    has_icon = TRUE,
    icon = "fa fa-save",
    class = "buttom_small")
```


```{r, echo = FALSE}
web_based_data_kb
```


# Graphing {.tabset}

## Baseline Stability 

```{r, fig.width = 8, fig.height = 7.5}
baseline_v <- read.csv("data/baseline_v.csv")
intervention_v <- read.csv("data/intervention_v.csv")

baseline_v$max_A_date <-as.Date(baseline_v$max_A_date, format = "%m/%d/%Y")
intervention_v$max_B_date <-as.Date(intervention_v$max_B_date, format = "%m/%d/%Y")
web_based_data$date <-as.Date(web_based_data$date, format = "%m/%d/%Y")
web_based_data$case <- paste0("Case ", web_based_data$case, sep = "")
baseline_v$case <- paste0("Case ", baseline_v$case, sep = "")
intervention_v$case <- paste0("Case ", intervention_v$case, sep = "")

ticks <- function(n) {function(limits) pretty(limits, n)}

web_based_data <- web_based_data %>%
  group_by(case, date) %>%
  mutate(average_outcome = round(mean(outcome),0)) 

web_based_data_baseline <- web_based_data %>%
  filter(phase== "Baseline") %>%
  group_by(case) %>%
  mutate(median = median(average_outcome)) %>%
  mutate(upper_threshold = round(median + 0.25 * median, digits = 2)) %>%
  mutate(lower_threshold = round(median - 0.25 * median, digits = 2))

average_outcome_baseline.plot <- web_based_data %>%
  ggplot(aes(x = date, y = average_outcome, group = phase)) +
  facet_wrap2(case ~ ., ncol = 1, axes = "all", remove_labels = "all") +
  geom_line(data = web_based_data %>% filter(phase %in% c("Baseline", "Intervention", "Maintenance")),
            aes(group = paste(phase, question_type)),
            linewidth = 0.5) +
  geom_point(size = 2) +
  scale_x_date(labels = function(zero) gsub("^0", "", strftime(zero, "%m/%d")),
               date_breaks = "4 day",
               expand = c(0.02, 0.02)) +
  scale_y_continuous(breaks = ticks(5)) +
  theme_minimal(base_size = 11) +
  theme(
    plot.title = element_text(face = "bold", size = 11),
    legend.position ="top",
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    legend.text = element_text(size = 11),
    legend.title = element_text(size = 11),
    legend.title.align = 0.5,
    axis.line = element_line(),          
    strip.text.x = element_text(color = "#3B3B3B", size = 11),
    axis.line.x = element_line(color = "#3B3B3B"),
    axis.text.x = element_text(size = 11, color = "#3B3B3B", angle = 45, hjust = 1),
    axis.ticks = element_line(color = "#3B3B3B"),
    axis.ticks.length = unit(0.1, "cm"),  
    axis.text.y = element_text(size = 11, color = "#3B3B3B"),
    axis.title = element_text(face = "bold", size = 11, color = "#3B3B3B")
  ) +
  labs(
    x = "Date",
    y = "Average Percentage Correct",
    title = ""
  ) +
  guides(shape="none") +
  geom_hline(data = web_based_data_baseline, aes(yintercept = web_based_data_baseline$upper_threshold),
             linetype = "longdash", linewidth = 0.5, color = "#CC5500") +
  geom_hline(data = web_based_data_baseline, aes(yintercept = web_based_data_baseline$median),
             linetype = "solid", linewidth = 0.5, color = "#4c4c4c") +
  geom_hline(data = web_based_data_baseline, aes(yintercept = web_based_data_baseline$lower_threshold),
             linetype = "longdash", linewidth = 0.5, color = "#CC5500") +
  geom_vline(data = baseline_v, aes(xintercept = baseline_v$max_A_date + 0.5),
             linetype = "longdash", linewidth = 0.5, color = "#4c4c4c") +
  geom_vline(data = intervention_v, aes(xintercept = intervention_v$max_B_date + 0.5),
             linetype = "longdash", linewidth = 0.5, color = "#4c4c4c") 

average_outcome_baseline.plot
```

## Student Performance

```{r, fig.width = 8, fig.height = 7.5}
web_based_data$question_type <- web_based_data$question_type %>% as.factor() 
question_names <- c("Problem-Solving", "Visualization") 
names(question_names) <- c("solving", "visual")
web_based_data$question_type <- as.factor(question_names[web_based_data$question_type])
web_based_data$question_type <- relevel(web_based_data$question_type, "Visualization")

outcome.plot <- web_based_data %>%
  ggplot(aes(x = date, y = outcome, color = as.factor(question_type), group = question_type)) +
  facet_wrap2(case ~ ., ncol = 1, axes = "all", remove_labels = "all") +
  geom_line(data = web_based_data %>% filter(phase %in% c("Baseline", "Intervention", "Maintenance")),
            aes(group = paste(phase, question_type)),
            linewidth = 0.5) +
  geom_point(size = 2, aes(shape = question_type)) +
  scale_shape_manual(values = c(16, 17)) +
  scale_x_date(labels = function(zero) gsub("^0", "", strftime(zero, "%m/%d")),
               date_breaks = "4 day",
               expand = c(0.02, 0.02)) +
  scale_y_continuous(breaks = ticks(5)) +
  theme_minimal(base_size = 11) +
  theme(
    plot.title = element_text(face = "bold", size = 11),
    legend.position ="top",
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    legend.text = element_text(size = 11),
    legend.title = element_text(size = 11),
    legend.title.align = 0.5,
    axis.line = element_line(),          
    strip.text.x = element_text(color = "#3B3B3B", size = 11),
    axis.line.x = element_line(color = "#3B3B3B"),
    axis.text.x = element_text(size = 11, color = "#3B3B3B", angle = 45, hjust = 1),
    axis.ticks = element_line(color = "#3B3B3B"),
    axis.ticks.length = unit(0.1, "cm"),  
    axis.text.y = element_text(size = 11, color = "#3B3B3B"),
    axis.title = element_text(face = "bold", size = 11, color = "#3B3B3B")
  ) +
  labs(
    x = "Date",
    y = "Percentage Correct",
    title = ""
  ) +
  guides(shape="none") +
  guides(color = guide_legend(title = "Question Type"), shape = guide_legend(title="Question Type")) +
  geom_vline(data = baseline_v, aes(xintercept = baseline_v$max_A_date + 0.5),
             linetype = "longdash", linewidth = 0.5, color = "#4c4c4c") +
  geom_vline(data = intervention_v, aes(xintercept = intervention_v$max_B_date + 0.5),
             linetype = "longdash", linewidth = 0.5, color = "#4c4c4c") 

outcome.plot 
```

<br>

# Visual Analysis {.tabset}

## Within-Phase Patterns

```{r}
lm_desc <- web_based_data %>%
  group_by(case, phase, question_type) %>%
  do(tidy(lm(outcome ~ day, data = .))) %>%
  filter(term == "day") %>% 
  mutate_if(is.numeric, ~round(., 2)) %>%
  select(case, phase, question_type, estimate, std.error)

lm_desc$trend <- lm_desc$estimate
lm_desc$SE <- lm_desc$std.error

outcome_desc <- web_based_data %>%
  group_by(case, phase, question_type) %>%
  summarise(min = min(outcome), 
            max = max(outcome), 
            level = mean(outcome),
            median = median(outcome),
            SD = sd(outcome),
            range = paste(min, "-", max)) %>% 
  mutate_if(is.numeric, ~round(., 2)) %>%
  select(everything(), -min, -max)

within_td <- list(outcome_desc, lm_desc) %>% purrr::reduce(left_join) 

within_td$SD <- paste0("(", within_td $SD, ")")
within_td$level <- paste(within_td $level, within_td $SD)
colnames(within_td )[colnames(within_td ) == "level"] <- "level (SD)"

within_td $SE <- paste0("(", within_td $SE, ")")
within_td $trend <- paste(within_td $trend, within_td $SE)
colnames(within_td )[colnames(within_td ) == "trend"] <- "trend (SE)"

within_td  %>% 
  select(case, phase, question_type, "level (SD)", "trend (SE)", range) %>%
  kbl(align = "c") %>%
  kable_styling(
    bootstrap_options = c("striped","hover","condensed"),
    full_width = T,
    font_size = 12,
    fixed_thead = T) %>%
  scroll_box(height = "350px")
```

<br>

## Between-Phase Patterns 

#### **Baseline vs Intervention** 

```{r}
outcome_AB <- batch_calc_ES(dat = web_based_data,
                            grouping = c(case, question_type),
                            condition = phase,
                            outcome = outcome,
                            session_number = day,
                            baseline_phase = "Baseline",
                            intervention_phase = "Intervention",
                            ES = c("Tau"),
                            improvement = "increase",
                            format = "wide") %>%
  mutate_if(is.numeric, ~round(., 2)) %>%
  kbl(align = "c") %>%
  kable_styling(
    bootstrap_options = c("striped","hover","condensed"),
    full_width = T,
    font_size = 12,
    fixed_thead = T) 

outcome_AB
```

#### **Intervention vs Maintenance** 

```{r}
outcome_BM <- batch_calc_ES(dat = web_based_data,
                            grouping = c(case, question_type),
                            condition = phase,
                            outcome = outcome,
                            session_number = day,
                            baseline_phase = "Intervention",
                            intervention_phase = "Maintenance",
                            ES = c("Tau"),
                            improvement = "increase",
                            format = "wide") %>%
  mutate_if(is.numeric, ~round(., 2)) %>%
  kbl(align = "c") %>%
  kable_styling(
    bootstrap_options = c("striped","hover","condensed"),
    full_width = T,
    font_size = 12,
    fixed_thead = T) 

outcome_BM
```

# Supplemental Materials {.tabset}

#### **Table S1. Rubric to Evaluate Students’ Mathematical Performances**

```{r}
tableS1 <- read.csv("data/tableS1.csv")

rubric <- kable(tableS1, align = "lccc", 
                col.names = c("Type", "Rubric", "Correct", "Score", 
                              "Type", "Rubric", "Correct", "Score"), 
                caption = "") %>%
  kable_styling(full_width = FALSE) %>%
  row_spec(0, bold = TRUE)
```

```{r, echo = FALSE}
rubric
```

